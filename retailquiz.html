<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retail cut quiz</title>
    <style>
        :root {
            --primary-color: #3a6ea5;
            --secondary-color: #f0f5fa;
            --accent-color: #ff6b6b;
            --text-color: #333;
            --light-gray: #f5f5f5;
            --border-color: #ddd;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--secondary-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 0;
            margin: 0;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px 40px;
        }
        
        #quiz-container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        #image-container {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            background-color: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
        }
        
        #image-container img {
            max-width: 100%;
            max-height: 400px;
            height: auto;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        #quiz-form {
            width: 100%;
            max-width: 500px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(58, 110, 165, 0.2);
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            width: 100%;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        #answer-btn {
            background-color: var(--primary-color);
            color: white;
        }
        
        #answer-btn:hover {
            background-color: #2a5a8f;
            transform: translateY(-2px);
        }
        
        #next-btn {
            background-color: var(--accent-color);
            color: white;
        }
        
        #next-btn:hover {
            background-color: #ff5252;
            transform: translateY(-2px);
        }
        
        #result {
            margin-top: 25px;
            width: 100%;
            text-align: center;
        }
        
        .correct-answer {
            color: #4caf50;
            font-weight: bold;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .result-table {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            border-collapse: collapse;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .result-table th, 
        .result-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .result-table th {
            text-align: right;
            background-color: var(--light-gray);
            width: 40%;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .result-table tr:last-child th,
        .result-table tr:last-child td {
            border-bottom: none;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            color: #666;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            #quiz-container {
                padding: 20px;
            }
            
            button {
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Retail cut quiz</h1>
        <p> For training in the "Retail cut identification" training of the Australian ICMJ</p>
    </header>
    
    <div class="container">
        <div id="quiz-container">
            <div id="image-container">
                <img id="meat-image" src="" alt="Retail cut image">
            </div>
            
            <form id="quiz-form">
                <div class="form-group">
                    <label for="species">Species:</label>
                    <input type="text" id="species" name="species" placeholder="Enter the species" required>
                </div>
                
                <div class="form-group">
                    <label for="retail-cut-name">Retail Cut Name:</label>
                    <input type="text" id="retail-cut-name" name="retail-cut-name" placeholder="Enter the retail cut name" required>
                </div>
                
                <div class="form-group">
                    <label for="primal-name">Primal Name:</label>
                    <input type="text" id="primal-name" name="primal-name" placeholder="Enter the primal name" required>
                </div>
                
                <div class="buttons">
                    <button type="button" id="answer-btn">Check Answer</button>
                    <button type="button" id="next-btn">Next Cut</button>
                </div>
            </form>
            
            <div id="result"></div>
        </div>
    </div>
    
    <footer>
        <p>&copy; 2025 takam1602</p>
    </footer>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let images = [];
            const meatImage = document.getElementById('meat-image');
            const resultDiv = document.getElementById('result');
            const nextBtn = document.getElementById('next-btn');
            const answerBtn = document.getElementById('answer-btn');
            const retailCutInput = document.getElementById('retail-cut-name');
            const speciesInput = document.getElementById('species');
            const primalInput = document.getElementById('primal-name');

            // CSVファイルの読み込みと解析
            Papa.parse('retailIndex_utf8.csv', {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    console.log("CSV読み込み完了:", results);
                    if (results.errors.length > 0) {
                        console.error("CSVパースエラー:", results.errors);
                        results.errors.forEach(error => {
                            console.error("エラーの詳細:", error);
                        });
                        return;
                    }
                    images = results.data;
                    console.log("パースされたデータ:", images);
                    loadRandomImage();
                },
                error: function(error) {
                    console.error("CSV読み込みエラー:", error);
                }
            });

            nextBtn.addEventListener('click', loadRandomImage);
            answerBtn.addEventListener('click', checkAnswer);

            let currentImageIndex = -1;

            function loadRandomImage() {
                if (images.length > 0) {
                    currentImageIndex = Math.floor(Math.random() * images.length);
                    const selectedImage = images[currentImageIndex];
                    console.log("選択された画像データ:", selectedImage);
                    if (selectedImage && selectedImage.src) {
                        meatImage.src = selectedImage.src;
                    } else {
                        console.error("画像データが不正です:", selectedImage);
                        meatImage.src = "";
                    }
                    resultDiv.textContent = '';
                    retailCutInput.value = '';
                    speciesInput.value = '';
                    primalInput.value = '';
                } else {
                    console.error("画像データがありません");
                }
            }

            function normalizeInput(input) {
                return input.trim().toLowerCase().replace(/[\s\u3000]+/g, ' ');
            }

            function checkAnswer() {
                if (currentImageIndex === -1) return;

                const retailCut = normalizeInput(retailCutInput.value);
                const species = normalizeInput(speciesInput.value);
                const primal = normalizeInput(primalInput.value);

                const correctData = images[currentImageIndex];

                const correctRetailCut = normalizeInput(correctData.retailCut);
                const correctSpecies = normalizeInput(correctData.species);
                const correctPrimal = normalizeInput(correctData.primal);

                if (retailCut === correctRetailCut &&
                    species === correctSpecies &&
                    primal === correctPrimal) {
                    resultDiv.innerHTML = '<div class="correct-answer">Correct!</div>';
                } else {
                    resultDiv.innerHTML = `
                        <table class="result-table">
                            <tr>
                                <th>Species:</th>
                                <td>${correctData.species}</td>
                            </tr>
                            <tr>
                                <th>Retail cut name:</th>
                                <td>${correctData.retailCut}</td>
                            </tr>
                            <tr>
                                <th>Primal name:</th>
                                <td>${correctData.primal}</td>
                            </tr>
                        </table>`;
                }
            }
        });
    </script>
</body>
</html>
